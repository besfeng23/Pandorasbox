# Settings for Backend (on Cloud Run).
# See https://firebase.google.com/docs/app-hosting/configure#cloud-run
runConfig:
  minInstances: 1 # CRITICAL: Keeps the CPU from freezing immediately after response
  maxInstances: 10
  concurrency: 80
  cpu: 1
  memoryMiB: 2048

# Environment variables and secrets.
env:
  # Public Firebase configuration (needed at BUILD time for Next.js)
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    value: AIzaSyBd6iZ2jEx1jmniBLD35no5gu1J4D4tSCM
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
    value: seismic-vista-480710-q5.firebaseapp.com
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_PROJECT_ID
    value: seismic-vista-480710-q5
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
    value: seismic-vista-480710-q5.firebasestorage.app
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
    value: "536979070288"
    availability:
      - BUILD
      - RUNTIME
  
  - variable: NEXT_PUBLIC_FIREBASE_APP_ID
    value: 1:536979070288:web:57b05547304f0056526055
    availability:
      - BUILD
      - RUNTIME

  # Sentry DSN for error tracking
  - variable: NEXT_PUBLIC_SENTRY_DSN
    value: https://9c170ff10657b483a588e3f631bdfeb8@o4510689910784000.ingest.de.sentry.io/4510689928740944
    availability:
      - BUILD
      - RUNTIME

  # API Keys - Using Cloud Secret Manager
  # See https://firebase.google.com/docs/app-hosting/configure#secret-parameters
  - variable: FIREBASE_SERVICE_ACCOUNT_KEY
    secret: firebase-service-account-key@1
    availability:
      - RUNTIME

  - variable: FIREBASE_PROJECT_ID
    value: seismic-vista-480710-q5
    availability:
      - BUILD
      - RUNTIME
  
  # CRON_SECRET for securing API routes
  - variable: CRON_SECRET
    secret: cron-secret
    availability:
      - RUNTIME
  
  # Sovereign AI Configuration
  - variable: INFERENCE_URL
    value: http://10.128.0.4:8000/v1
    availability:
      - RUNTIME

  - variable: INFERENCE_MODEL
    value: mistralai/Mistral-7B-Instruct-v0.3
    availability:
      - RUNTIME

  - variable: QDRANT_URL
    value: http://10.128.0.7:6333
    availability:
      - RUNTIME

  - variable: EMBEDDING_MODEL
    value: all-MiniLM-L6-v2
    availability:
      - RUNTIME
  
  # Firebase Admin Credentials (using ADMIN_ prefix to avoid reserved FIREBASE_ prefix)
  - variable: ADMIN_CLIENT_EMAIL
    secret: firebase-client-email
    availability:
      - RUNTIME

  - variable: ADMIN_PRIVATE_KEY
    secret: firebase-private-key
    availability:
      - RUNTIME

  # Tavily Search API
  - variable: TAVILY_API_KEY
    secret: tavily-api-key
    availability:
      - RUNTIME
      
  # Server Configuration (Fix for Cloud Run)
  - variable: HOSTNAME
    value: "0.0.0.0"
    availability:
      - RUNTIME
